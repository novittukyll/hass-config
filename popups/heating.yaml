action: fire-dom-event
browser_mod:
  command: popup
  title: Lämmitys
  style:
    $: |
      .mdc-dialog .mdc-dialog__surface {
        background-color: var(--primary-background-color) !important;
      }
  card:
    type: custom:mod-card
    card_mod:
      style: |
        ha-card {
          padding: 16px
        }
        ha-card.type-custom-mod-card {
          background-color: var(--primary-background-color);
        }
    card:
      type: vertical-stack
      cards: 
        - type: custom:button-card
          template: title
          name: "[[[ return 'Päivitetty klo ' + states['sensor.nibe_data_age'].state ]]]"
          label: Tila
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              template: card_generic_icon_small_swapped
              entity: sensor.nibe_heat_pump_state
              show_last_changed: true
              name: "[[[ return entity.state ]]]"
              styles:
                icon:
                  - color: |
                      [[[
                        var color = 'var(--custom-icon-color)'
                        if (entity.state == 'Lämmitys') {
                          color = 'red';
                        } else if (entity.state == 'Joutilas') {
                          color = 'rgba(var(--color-theme),0.2)' // minimalist default
                        }

                        return color;
                      ]]]
            - type: custom:button-card
              template: card_generic_icon_small
              entity: sensor.nibe_daily_num_starts
              icon: mdi:play
              name: Käynnistykset
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              template: card_generic_icon_small
              entity: sensor.nibe_degree_minutes
            - type: custom:button-card
              template: card_generic_icon_small
              entity: sensor.nibe_alarm_number
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              template: card_generic_icon_small
              entity: sensor.nibe_average_heating_cycle
              name: Lämmitys
            - type: custom:button-card
              template: card_generic_icon_small
              entity: sensor.nibe_average_resting_cycle
              name: Lepo
        - type: custom:button-card
          template: title
          label: Lämmönkeruu
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              template: card_temperature
              entity: sensor.nibe_daily_brine_min_input_temp
            - type: custom:button-card
              template: card_temperature
              entity: sensor.nibe_daily_brine_min_output_temp
            - type: custom:button-card
              template: card_generic_icon_small
              entity: sensor.nibe_brine_pump_speed
              name: Nopeus
        - type: horizontal-stack
          cards:
            - type: custom:mini-graph-card
              style: |
                ha-card {
                  border-radius: 20px;
                }
              name: Lämmönkeruu
              entities:
                - entity: sensor.nibe_brine_in_temp
                  name: Sisään
                  color: 'var(--google-green)'
                - entity: sensor.nibe_brine_out_temp
                  name: Ulos
                  show_state: true
                  color: dodgerblue
              decimals: 1
              hours_to_show: 24
              points_per_hour: 8
              hour24: true
              show:
                extrema: true
                name: false
                icon: false
              height: 150
              line_width: 3
        - type: custom:button-card
          template: title
          label: Käyttövesi
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              template: card_generic_icon_small
              entity: switch.tplink_hs100_1
        - type: horizontal-stack
          cards:
            - type: custom:mini-graph-card
              style: |
                ha-card {
                  border-radius: 20px;
                }
              name: Käyttövesi
              entities:
                - entity: sensor.nibe_hot_water_top_temp
                  name: Yläosa
                  color: 'red'
                - entity: sensor.nibe_hot_water_fill_temp
                  name: Täyttö
                  show_state: true
              show:
                extrema: true
                name: false
                icon: false
              decimals: 1
              hours_to_show: 24
              points_per_hour: 3
              hour24: true
              height: 150
              line_width: 3
        - type: custom:button-card
          template: title
          label: Lämmöntuotto
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              template: card_temperature
              entity: sensor.nibe_calculated_supply_temp
            - type: custom:button-card
              template: card_generic_icon_small
              entity: sensor.nibe_supply_pump_speed
              name: Pumpun nopeus
        - type: horizontal-stack
          cards:
            - type: custom:mini-graph-card
              style: |
                ha-card {
                  border-radius: 20px;
                }
              entities:
                - entity: sensor.nibe_supply_temp
                  name: Lämmöntuotto
                - entity: sensor.nibe_supply_return_temp
                  name: Paluulämpötila
                  show_state: true
                  color: dodgerblue
              color_thresholds:
                - value: 35
                  color: var(--accent-color)
                - value: 37
                  color: red
              decimals: 1
              hours_to_show: 24
              points_per_hour: 8
              hour24: true
              show:
                extrema: true
                name: false
                icon: false
              height: 150
              line_width: 3